
# StateMover Path
StateMover_PATH = ~/StateMover

# CSSIM Path
CSR_SIM_PATH = $(StateMover_PATH)/CSR_SIM

# Vivado Installation Path
VIVADO_PATH = ~/Xilinx/Vivado/2018.3

# Modelsim Flags
VSIM_FLAGS = -pli $(CSR_SIM_PATH)/csr_sim.sl -t ps -voptargs=+acc +notimingchecks 
VSIM_LFLAGS = -L unisims_ver -L unisim -L unimacro_ver -L secureip -L xpm

all: compile run_gui

run:
	vsim -do "run -all ;quit -force" -c sys_tb work.glbl $(VSIM_FLAGS) $(VSIM_LFLAGS)

run_gui:
	vsim -do "radix hex; add wave /sys_tb/uut/inst_count/clk; add wave /sys_tb/uut/inst_count/rst; add wave /sys_tb/uut/inst_count/count_out; add wave /sys_tb/uut/inst_count/count_reg;" sys_tb work.glbl $(VSIM_FLAGS) $(VSIM_LFLAGS)


compile: clean
	vlib work

	vlog $(VIVADO_PATH)/data/verilog/src/glbl.v

	# Implementation netlist generated by the scripts under the Vivado Project
	vlog ./counter/counter_impl_netlist.v
	
	# Top Module
	vlog $(StateMover_PATH)/IPs/IL/interruption_logic_v1.v
	vlog top.v
	vlog sys_tb.v

hardware_create_project: 
	vivado -mode tcl -source vivado_create_project.tcl -nolog -nojournal

hardware_implement: 
	vivado -mode tcl -source vivado_implement.tcl -nolog -nojournal

clean:
	rm -rf work
	rm -f transcript
	rm -f vsim.wlf
